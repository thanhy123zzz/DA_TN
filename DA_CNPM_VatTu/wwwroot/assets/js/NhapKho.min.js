function updateTableThemPhieuXuat(n){n.forEach(function(n){addRowPhieuNhapCt(n)})}function getRowPhieuNhapCt(){return`<tr>
        <td><select class="form-select form-table" name="Idhh" style="width: 300px;"></select></td>
        <td><input autocomplete="off" class="form-control form-table dvt" type="text" readonly style="min-width: 80px;"/></td>
        <td><select class="form-select form-table" name="SoLo" style="width: 120px;"></select></td>
        <td><input autocomplete="off" class="form-control form-table input-number-float" name="Sl" style="min-width: 80px;"/></td>
        <td><input autocomplete="off" class="form-control form-table input-number-float" name="DonGia" style="min-width: 120px;"/></td>
        <td><input autocomplete="off" class="form-control form-table ThanhTien input-number-float" style="min-width: 140px;"/></td>
        <td><input autocomplete="off" class="form-control form-table input-number-float" name="Cktm" style="min-width: 60px;"/></td>
        <td><input autocomplete="off" class="form-control form-table input-number-float" name="Thue" style="min-width: 60px;"/></td>
        <td><input autocomplete="off" class="form-control form-table date-sort-mask" name="Nsx" style="min-width: 110px;"/></td>
        <td><input autocomplete="off" class="form-control form-table date-sort-mask" name="Hsd" style="min-width: 110px;"/></td>
        <td class='last-td-column'>
            <div class="action justify-content-end">
                <button class="text-danger btn-remove-ct">
                    <i class="lni lni-trash-can"></i>
                </button>
            </div>
        </td>
    </tr>`}function configRowPhieuNhapCt(n,t){var i=n.find('select[name="Idhh"]');i.selectize({maxOptions:50,valueField:"id",labelField:"tenHh",searchField:["tenHh","maHh"],placeholder:"-- Hàng hoá --",options:t,loadThrottle:400,dropdownParent:"#dropdow-show",closeAfterSelect:0,onDropdownOpen:function(n){showDropdownMenu(i,n)},onChange:function(n){dropDownHhChange(i,n)},onFocus:function(){$(".my-selectize-2").not(this.$input).each(function(){this.selectize&&(this.selectize.close(),this.selectize.blur())})},render:{option:function(n){return`<div class="px-2 py-1"><b>[${n.maHh}]</b> - ${n.tenHh}</div>`},no_results:function(){return'<div class="no-results">Không tìm thấy dữ liệu <\/div>'},dropdown:function(){return`<div style="width: 50vw;"></div>`}}});formatNumberFloatWithElement($("tr .input-number-float"));configDateLongMask($(".date-sort-mask"))}function dropDownHhChange(n,t){var r=n.closest("tr"),f=n[0].selectize,i;if(f&&t){var e=Object.values(f.options),o=e.find(function(n){return n.id==t}),u=[];o.soLos.forEach(function(n){u.push({soLo:n})});r.find("input.dvt").val(o.tenDonViTinh);i=r.find('select[name="SoLo"]');i[0].selectize?(i[0].selectize.clear(),i[0].selectize.clearOptions(),i[0].selectize.addOption(u)):i.selectize({placeholder:"-- Số lô --",options:u,valueField:"soLo",labelField:"soLo",searchField:["soLo"],create:!0,dropdownParent:"#dropdow-show",closeAfterSelect:0,onDropdownOpen:function(n){showDropdownMenu(i,n)},onFocus:function(){$(".my-selectize-2").not(this.$input).each(function(){this.selectize&&(this.selectize.close(),this.selectize.blur())})}});r.is(":last-child")&&($("#tBodyCtpn").append(getRowPhieuNhapCt()),configRowPhieuNhapCt($("#tBodyCtpn tr:last"),e))}}function updateGiaTongTien(){var n=0,t=0,i=0;$("#tBodyCtpn tr").each(function(){var f=$(this),r=parseFloat(f.find("input.ThanhTien").inputmask("unmaskedvalue")),e,u,o,s;r&&(n+=parseFloat(r));e=parseFloat(f.find('input[name="Cktm"]').inputmask("unmaskedvalue"));u=0;e&&r&&(u=e*r/100,t+=u);o=parseFloat(f.find('input[name="Thue"]').inputmask("unmaskedvalue"));s=0;o&&r&&(s=(r-u)*o/100,i+=s)});$("#TienHang").val(n);$("#TienCK").val(t);$("#TienThue").val(i);$("#TienThanhToan").val(n-t+i)}$(document).ready(function(){var n=[{el:$(".cbNhaCC"),placeholder:"-- Nhà cung cấp --",url:"/QuanLy/NhapKho/api/nccs"}];configCb(n);configDate();configDateTime();formatNumberFloatWithElement($(".input-number-float"));$.ajax({type:"POST",url:"/QuanLy/NhapKho/api/hhs"}).done(function(n){$("#tBodyCtpn").append(getRowPhieuNhapCt());configRowPhieuNhapCt($("#tBodyCtpn tr:last"),n)});$(document).on("click",".btn-remove-ct",function(){var n=$(this).closest("tr");n.is(":last-child")&&n.is(":first-child")||(n.find("select").each(function(){this.selectize&&this.selectize.destroy()}),n.remove(),updateGiaTongTien())});$(document).on("keyup",'input[name="Sl"]',function(){var n=$(this).closest("tr"),i=parseFloat($(this).inputmask("unmaskedvalue")),t=parseFloat(n.find('input[name="DonGia"]').inputmask("unmaskedvalue"));t!=""&&(n.find("input.ThanhTien").val(i*t),updateGiaTongTien())});$(document).on("keyup",'input[name="DonGia"]',function(){var n=$(this).closest("tr"),i=parseFloat($(this).inputmask("unmaskedvalue")),t=parseFloat(n.find('input[name="Sl"]').inputmask("unmaskedvalue"));t!=""&&(n.find("input.ThanhTien").val(t*i),updateGiaTongTien())});$(document).on("keyup","input.ThanhTien",function(){var n=$(this).closest("tr"),r=$(this).inputmask("unmaskedvalue"),t=n.find('input[name="Sl"]').inputmask("unmaskedvalue"),i=n.find('input[name="DonGia"]').inputmask("unmaskedvalue");if(i!==""||t!==""){if(t!==""){n.find('input[name="DonGia"]').val(r/t);updateGiaTongTien();return}if(i!==""){n.find('input[name="Sl"]').val(r/i);updateGiaTongTien();return}}});$(document).on("keyup",'input[name="Cktm"], input[name="Thue"]',function(){updateGiaTongTien()});$("#btnTaoPhieu").on("click",function(){var r=document.getElementById("formTaoPhieuNhap"),n,t,i;r.checkValidity()?($("#nhaCC").val()&&$("#NgayNhap").val()||($("#nhaCC").val()?showToast("Chưa nhập ngày tạo!",500):showToast("Chưa chọn nhà cung cấp!",500)),spinnerBtn($("#btnTaoPhieu")),n=[],t=!0,$("#tBodyCtpn tr").each(function(){var i=$(this),f=i.find('select[name="Idhh"]').val(),u;if(f){i.removeClass("bg-danger");var r=i.find('input[name="Sl"]').inputmask("unmaskedvalue"),e=i.find('input[name="Cktm"]').inputmask("unmaskedvalue"),o=i.find('input[name="Thue"]').inputmask("unmaskedvalue");r?(i.find('input[name="Sl"]').closest("td").removeClass("bg-danger"),u=getDataFromTr(i),n.push(u)):(r||i.find('input[name="Sl"]').closest("td").addClass("bg-danger"),t=!1,showBtn($("#btnTaoPhieu"),"Tạo phiếu"))}else i.is(":last-child")||i.addClass("bg-danger")}),t&&(i={Idncc:$("#nhaCC").val(),SoHd:$("#soHD").val(),NgayTao:$("#NgayNhap").val(),NgayHd:$("#ngayHD").val(),GhiChu:$("#ghiChu").val(),ChiTietPhieuNhaps:n},console.log(i),showBtn($("#btnTaoPhieu"),"Tạo phiếu"),$.ajax({type:"post",url:"/QuanLy/NhapKho/add-pn",data:JSON.stringify(i),contentType:"application/json",success:function(n){showToast(n.message,n.statusCode);showBtn($("#btnTaoPhieu"),"Tạo phiếu")},error:function(n){console.log(n);showBtn($("#btnTaoPhieu"),"Tạo phiếu")}}))):r.classList.add("was-validated")})});